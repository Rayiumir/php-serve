#!/usr/bin/env php
<?php

// check first argument
if (!isset($argv[1]) || $argv[1] !== 'server') {
    echo "Invalid command!\n";
    echo "Use: php run server\n";
    echo "Or: php run server 8080\n";
    exit(1);
}

// Default settings
$defaultPort = 8000;
$host = 'localhost';

// Get port from command line argument
$port = isset($argv[2]) && is_numeric($argv[2]) ? (int)$argv[2] : $defaultPort;

// Check port availability
if (!isPortAvailable($host, $port)) {
    echo "Port {$port} is in use.\n";
    echo "Try another port: php run server " . ($port + 1) . "\n";
    exit(1);
}

// Current project path
$projectPath = __DIR__;
$projectName = basename($projectPath);

// Display server information
echo "\n";
echo "PHP Development Server\n";
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n";
echo "Project: {$projectName}\n";
echo "Path: {$projectPath}\n";
echo "PHP: " . PHP_VERSION . "\n";
echo "━\n";
echo "Server is ready!\n";
echo "Go to http://{$host}:{$port} to view the project\n";
echo "Press Ctrl+C to stop\n\n";

// Run Server
$command = "php -S {$host}:{$port}";
system($command);